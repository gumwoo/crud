<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{thymeleaf/cmm/layout/subLayout}">
<head>
    <meta charset="UTF-8">
    <title>ì ì‹¬ë¹„ ë‚´ì—­</title>
    <style>
        /* ì „ì²´ ì»¨í…Œì´ë„ˆ */
        .lunch-list-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f8f9fc;
            min-height: 100vh;
        }
        
        /* í—¤ë” */
        .list-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        
        .list-header h2 {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin: 0;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-primary {
            padding: 10px 20px;
            background: #4361ee;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn-primary:hover {
            background: #3651d4;
        }
        
        /* í•„í„° ì˜ì—­ */
        .filter-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .filter-row {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .filter-row input[type="month"] {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        /* í…Œì´ë¸” ì¹´ë“œ */
        .table-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow-x: auto;
        }
        
        /* í…Œì´ë¸” */
        .lunch-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .lunch-table thead {
            background: #f8f9fc;
        }
        
        .lunch-table th {
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
            white-space: nowrap;
        }
        
        .lunch-table td {
            padding: 12px 8px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
            white-space: nowrap;
        }
        
        .lunch-table tbody tr:hover {
            background: #f8f9fc;
        }
        
        /* ì •ì‚° ì™„ë£Œëœ í–‰ */
        .lunch-table tbody tr.settled {
            background: #d9d9d9;
            color: #666;
        }
        
        .lunch-table tbody tr.settled:hover {
            background: #d0d0d0;
        }
        
        /* ì´í•© í–‰ */
        .lunch-table tfoot tr {
            background: #f0f4ff;
            font-weight: 600;
        }
        
        .lunch-table tfoot td {
            padding: 15px 8px;
            border-top: 2px solid #4361ee;
        }
        
        /* ì†¡ê¸ˆì•¡ í–‰ */
        .transfer-row td {
            background: #fff5e6;
        }
        
        .amount-positive {
            color: #d9534f;
        }
        
        .amount-negative {
            color: #4361ee;
        }
        
        /* ì •ì‚°ì™„ë£Œ ë²„íŠ¼ */
        .btn-settlement {
            padding: 6px 12px;
            background: white;
            color: #4361ee;
            border: 1px solid #4361ee;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-settlement:hover {
            background: #4361ee;
            color: white;
        }
        
        .btn-settlement:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ê´€ë¦¬ ë²„íŠ¼ */
        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 4px 8px;
            color: #666;
            transition: color 0.3s;
        }
        
        .btn-icon:hover {
            color: #4361ee;
        }
        
        .btn-delete:hover {
            color: #d9534f;
        }

        /* ëŒ€í‘œ ì •ì‚°ì ì •ë³´ */
        .representative-info {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .representative-info p {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }
        
        .representative-info .account {
            color: #4361ee;
            font-weight: 700;
        }
        
        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 700;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
        
        .modal-close:hover {
            color: #333;
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .modal-body p {
            margin: 10px 0;
            color: #666;
            line-height: 1.6;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .btn-secondary {
            padding: 10px 20px;
            background: #f0f0f0;
            color: #333;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            background: #e5e5e5;
        }
        
        /* ì•ˆë‚´ íŒ¨ë„ */
        .info-panel {
            background: #f8f9fc;
            border-left: 4px solid #4361ee;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        .info-panel h4 {
            margin: 0 0 15px 0;
            font-size: 16px;
            font-weight: 700;
            color: #333;
        }
        
        .info-panel ol {
            margin: 0;
            padding-left: 20px;
        }
        
        .info-panel li {
            margin-bottom: 8px;
            color: #666;
            line-height: 1.6;
        }
        
        .highlight {
            background: #d9d9d9;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 1200px) {
            .lunch-table {
                font-size: 12px;
            }
            
            .lunch-table th,
            .lunch-table td {
                padding: 8px 4px;
            }
        }
    </style>
</head>

<body>
    <div layout:fragment="content">
        <div class="lunch-list-container">
            <!-- í—¤ë” -->
            <div class="list-header">
                <h2>ğŸ“‹ ì ì‹¬ë¹„ ë‚´ì—­</h2>
                <div class="header-actions">
                    <button class="btn-primary" onclick="location.href='/lunch/lunchForm.do'">
                        âœï¸ ë‚´ì—­ ë“±ë¡
                    </button>
                </div>
            </div>

            <!-- ì•ˆë‚´ íŒ¨ë„ -->
            <div class="info-panel">
                <h4>ì´ í™”ë©´ì€ ì ì‹¬Â·ì»¤í”¼ ë‚´ì—­ì„ ì¡°íšŒí•˜ê³ , ê° ì‚¬ìš©ìë³„ ì‹¤ì œ ê²°ì œ ê¸ˆì•¡ì„ ê¸°ë°˜ìœ¼ë¡œ ìë™ ì •ì‚° ì²˜ë¦¬í•˜ëŠ” í•µì‹¬ ê´€ë¦¬ í˜ì´ì§€</h4>
                <ol>
                    <li><strong>ê²°ì œì(ëŒ€í‘œ ì§€ë¶ˆì)</strong>ëŠ” ë‹¹ì¼ ì „ì²´ ê¸ˆì•¡ì„ ì„ ê²°ì œí•œ ì‚¬ìš©ìë¡œ, ìƒ‰ ë°°ê²½ì— <span class="highlight">(#D9D9D9)</span> ì´ ì ìš©ë˜ì–´ ì‹œê°ì ìœ¼ë¡œ êµ¬ë¶„ë©ë‹ˆë‹¤.</li>
                    <li>ê° í–‰ì˜ ìš°ì¸¡ì—ëŠ” ìˆ˜ì •, ì‚­ì œ, ì •ì‚° ì™„ë£Œ ë²„íŠ¼ì´ ì¡´ì¬í•˜ë©°, ì‚¬ìš©ìê°€ ì†¡ê¸ˆ ì™„ë£Œ í›„ "ì •ì‚°ì™„ë£Œ"ë¥¼ í´ë¦­í•˜ë©´ ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë˜ê³  ìƒíƒœê°€ ë³€ê²½ë©ë‹ˆë‹¤.</li>
                    <li><strong>+ë©´ ë°›ì•„ì•¼ í•  ëˆ, -ë©´ ë³´ë‚´ì•¼ í•  ëˆ</strong></li>
                </ol>
            </div>
            
            <!-- í•„í„° ì˜ì—­ -->
            <div class="filter-section">
                <div class="filter-row">
                    <input type="month" id="monthFilter" value="">
                </div>
            </div>
            
            <!-- í…Œì´ë¸” ì¹´ë“œ -->
            <div class="table-card">
                <table class="lunch-table">
                    <thead>
                        <tr>
                            <th>ë‚ ì§œ</th>
                            <th>ê°€ê²Œ</th>
                            <th>ë°•ìš©ë³µ</th>
                            <th>ìš°ë½ì¼</th>
                            <th>ì¡°ì„ ì˜</th>
                            <th>ë¬¸ë“œí¬</th>
                            <th>ê°•ê±´ìš°</th>
                            <th>í•œìŠ¹ì¤€</th>
                            <th>í•©ê³„</th>
                            <th>ê´€ë¦¬</th>
                        </tr>
                    </thead>
                    <tbody id="lunchTableBody">
                        <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="2">ì´ê¸ˆì•¡</td>
                            <td id="totalPark">0</td>
                            <td id="totalWoo">0</td>
                            <td id="totalJo">0</td>
                            <td id="totalMoon">0</td>
                            <td id="totalKang">0</td>
                            <td id="totalHan">0</td>
                            <td id="totalAmount">0</td>
                            <td></td>
                        </tr>
                        <tr class="transfer-row">
                            <td colspan="2">ì†¡ê¸ˆì•¡</td>
                            <td id="transferPark">0</td>
                            <td id="transferWoo">0</td>
                            <td id="transferJo">0</td>
                            <td id="transferMoon">0</td>
                            <td id="transferKang">0</td>
                            <td id="transferHan">0</td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td colspan="10" style="padding: 15px;">
                                <button class="btn-settlement" onclick="openSettlementModal('park')">ì •ì‚°ì™„ë£Œ</button>
                                <button class="btn-settlement" onclick="openSettlementModal('woo')">ì •ì‚°ì™„ë£Œ</button>
                                <button class="btn-settlement" onclick="openSettlementModal('jo')">ì •ì‚°ì™„ë£Œ</button>
                                <button class="btn-settlement" onclick="openSettlementModal('moon')">ì •ì‚°ì™„ë£Œ</button>
                                <button class="btn-settlement" onclick="openSettlementModal('kang')">ì •ì‚°ì™„ë£Œ</button>
                                <button class="btn-settlement" onclick="openSettlementModal('han')">ì •ì‚°ì™„ë£Œ</button>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            
            <!-- ëŒ€í‘œ ì •ì‚°ì ì •ë³´ -->
            <div class="representative-info">
                <p>010 8254 9904 êµ­ë¯¼: <span class="account">ì´ìŠ¹ì€</span></p>
            </div>
        </div>
        
        <!-- ì •ì‚°ì™„ë£Œ ëª¨ë‹¬ -->
        <div class="modal" id="settlementModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ì •ì‚°ì„ ì™„ë£Œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
                    <button class="modal-close" onclick="closeModal('settlementModal')">Ã—</button>
                </div>
                <div class="modal-body">
                    <p>ì™„ë£Œ í›„ì—ëŠ” í•´ë‹¹ ë‚´ì—­ì´ ìˆ˜ì • ë¶ˆê°€ ìƒíƒœë¡œ ì „í™˜ë©ë‹ˆë‹¤.</p>
                    <p>ì •ì‚°ì´ ì™„ë£Œëœ í•­ëª©ì€ ëª©ë¡ì—ì„œ íšŒìƒ‰ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeModal('settlementModal')">ì·¨ì†Œ</button>
                    <button class="btn-primary" onclick="confirmSettlement()">ì •ì‚° ì™„ë£Œ</button>
                </div>
            </div>
        </div>
        
        <!-- ì‚­ì œ ëª¨ë‹¬ -->
        <div class="modal" id="deleteModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ì´ ë‚´ì—­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h3>
                    <button class="modal-close" onclick="closeModal('deleteModal')">Ã—</button>
                </div>
                <div class="modal-body">
                    <p>ì‚­ì œ í›„ì—ëŠ” ë³µêµ¬ê°€ ë¶ˆê°€í•©ë‹ˆë‹¤.</p>
                    <p>í•„ìš”í•œ ê²½ìš° ì‚­ì œ ì „ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeModal('deleteModal')">ì·¨ì†Œ</button>
                    <button class="btn-primary" style="background: #d9534f;" onclick="confirmDelete()">ì‚­ì œí•˜ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script th:inline="javascript">
        let currentLunchId = null; // í˜„ì¬ ì„ íƒëœ ë‚´ì—­ ID
        let currentUserId = null; // í˜„ì¬ ì„ íƒëœ ì‚¬ìš©ì ID
        
        // ì‚¬ìš©ì ëª©ë¡ (ìˆœì„œ ì¤‘ìš” - í…Œì´ë¸” ì»¬ëŸ¼ ìˆœì„œì™€ ì¼ì¹˜)
        const users = [
            { id: 'park', name: 'ë°•ìš©ë³µ' },
            { id: 'woo', name: 'ìš°ë½ì¼' },
            { id: 'jo', name: 'ì¡°ì„ ì˜' },
            { id: 'moon', name: 'ë¬¸ë“œí¬' },
            { id: 'kang', name: 'ê°•ê±´ìš°' },
            { id: 'han', name: 'í•œìŠ¹ì¤€' }
        ];
        
        $(document).ready(function() {
            // í˜„ì¬ ì›”ë¡œ ì´ˆê¸°í™”
            const today = new Date();
            const currentMonth = today.toISOString().slice(0, 7);
            $('#monthFilter').val(currentMonth);
            
            // ë°ì´í„° ë¡œë“œ
            loadLunchList();
            
            // ì›” ë³€ê²½ ì´ë²¤íŠ¸
            $('#monthFilter').on('change', function() {
                loadLunchList();
            });
        });
        
        /**
         * ì ì‹¬ ë‚´ì—­ ëª©ë¡ ì¡°íšŒ
         */
        function loadLunchList() {
            const month = $('#monthFilter').val();
            if (!month) return;
            
            const [year, monthNum] = month.split('-');
            const startDate = `${year}-${monthNum}-01`;
            const lastDay = new Date(year, monthNum, 0).getDate();
            const endDate = `${year}-${monthNum}-${lastDay}`;
            
            const params = {
                startDate: startDate,
                endDate: endDate,
                settlementStatus: '' // ì „ì²´ ì¡°íšŒ
            };
            
            $.ajax({
                url: '/lunch/getLunchList.do',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(params),
                success: function(response) {
                    if (response.success) {
                        renderTable(response.data);
                    } else {
                        alert(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('ì¡°íšŒ ì˜¤ë¥˜:', error);
                    alert('ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }
        
        /**
         * í…Œì´ë¸” ë Œë”ë§
         */
        function renderTable(data) {
            const lunchList = data.lunchList || [];
            const summary = data.summary || {};
            
            // í…Œì´ë¸” ë°”ë”” ë Œë”ë§
            const tbody = $('#lunchTableBody');
            tbody.empty();
            
            if (lunchList.length === 0) {
                tbody.html('<tr><td colspan="10" style="padding: 40px; text-align: center; color: #999;">ì¡°íšŒëœ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>');
                resetSummary();
                return;
            }
            
            lunchList.forEach(lunch => {
                const row = createTableRow(lunch);
                tbody.append(row);
            });
            
            // ì´í•© ë° ì†¡ê¸ˆì•¡ ë Œë”ë§
            renderSummary(summary);
        }

        /**
         * í…Œì´ë¸” í–‰ ìƒì„±
         */
        function createTableRow(lunch) {
            const isSettled = lunch.settlementStatus === 'ì™„ë£Œ';
            const rowClass = isSettled ? 'settled' : '';
            
            // ë‚ ì§œ í¬ë§· (MM-DD)
            const dateStr = lunch.lunchDate ? lunch.lunchDate.substring(5, 10) : '';
            
            // ì°¸ì—¬ìë³„ ê¸ˆì•¡ ë§µ ìƒì„±
            const amountMap = {};
            if (lunch.participants) {
                lunch.participants.forEach(p => {
                    amountMap[p.userId] = p.amount;
                });
            }
            
            // ê° ì‚¬ìš©ì ì»¬ëŸ¼
            let userCols = '';
            users.forEach(user => {
                const amount = amountMap[user.id] || 0;
                const displayAmount = amount > 0 ? amount.toLocaleString() : '-';
                userCols += `<td>${displayAmount}</td>`;
            });
            
            // ê´€ë¦¬ ë²„íŠ¼
            const editBtn = isSettled ? '' : `<button class="btn-icon" onclick="editLunch(${lunch.lunchId})" title="ìˆ˜ì •">âœï¸</button>`;
            const deleteBtn = `<button class="btn-icon btn-delete" onclick="openDeleteModal(${lunch.lunchId})" title="ì‚­ì œ">ğŸ—‘ï¸</button>`;
            
            return `
                <tr class="${rowClass}">
                    <td>${dateStr}</td>
                    <td>${lunch.storeName || ''}</td>
                    ${userCols}
                    <td>${lunch.totalAmount.toLocaleString()}</td>
                    <td>
                        ${editBtn}
                        ${deleteBtn}
                    </td>
                </tr>
            `;
        }
        
        /**
         * ì´í•© ë° ì†¡ê¸ˆì•¡ ë Œë”ë§
         */
        function renderSummary(summary) {
            if (!summary || !summary.userTotalMap) {
                resetSummary();
                return;
            }
            
            let totalAmount = 0;
            
            // ê° ì‚¬ìš©ìë³„ ì´í•©
            users.forEach(user => {
                const total = summary.userTotalMap[user.id] || 0;
                $(`#total${capitalize(user.id)}`).text(total.toLocaleString());
                totalAmount += total;
            });
            
            // ì „ì²´ ì´í•©
            $('#totalAmount').text(totalAmount.toLocaleString());
            
            // ê° ì‚¬ìš©ìë³„ ì†¡ê¸ˆì•¡
            users.forEach(user => {
                const transfer = summary.userTransferMap[user.id] || 0;
                const $cell = $(`#transfer${capitalize(user.id)}`);
                
                if (transfer > 0) {
                    // ë³´ë‚¼ ëˆ (ì–‘ìˆ˜)
                    $cell.html(`<span class="amount-positive">+${transfer.toLocaleString()}</span>`);
                } else if (transfer < 0) {
                    // ë°›ì„ ëˆ (ìŒìˆ˜)
                    $cell.html(`<span class="amount-negative">${transfer.toLocaleString()}</span>`);
                } else {
                    $cell.text('0');
                }
            });
        }
        
        /**
         * ì´í•© ì´ˆê¸°í™”
         */
        function resetSummary() {
            users.forEach(user => {
                $(`#total${capitalize(user.id)}`).text('0');
                $(`#transfer${capitalize(user.id)}`).text('0');
            });
            $('#totalAmount').text('0');
        }
        
        /**
         * ì²« ê¸€ì ëŒ€ë¬¸ì ë³€í™˜ (userId â†’ UserId)
         */
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        /**
         * ìˆ˜ì • í™”ë©´ ì´ë™
         */
        function editLunch(lunchId) {
            location.href = `/lunch/lunchForm.do/${lunchId}`;
        }
        
        /**
         * ì‚­ì œ ëª¨ë‹¬ ì—´ê¸°
         */
        function openDeleteModal(lunchId) {
            currentLunchId = lunchId;
            $('#deleteModal').addClass('show');
        }
        
        /**
         * ì •ì‚°ì™„ë£Œ ëª¨ë‹¬ ì—´ê¸°
         */
        function openSettlementModal(userId) {
            currentUserId = userId;
            $('#settlementModal').addClass('show');
        }
        
        /**
         * ëª¨ë‹¬ ë‹«ê¸°
         */
        function closeModal(modalId) {
            $(`#${modalId}`).removeClass('show');
        }
        
        /**
         * ì‚­ì œ í™•ì¸
         */
        function confirmDelete() {
            if (!currentLunchId) return;
            
            $.ajax({
                url: '/lunch/deleteLunch.do',
                type: 'POST',
                data: { lunchId: currentLunchId },
                success: function(response) {
                    if (response.success) {
                        alert(response.message);
                        closeModal('deleteModal');
                        loadLunchList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    } else {
                        alert(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                    alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }
        
        /**
         * ì •ì‚°ì™„ë£Œ í™•ì¸
         */
        function confirmSettlement() {
            if (!currentUserId) return;
            
            // TODO: ì‹¤ì œë¡œëŠ” í•´ë‹¹ ì‚¬ìš©ìì˜ ëª¨ë“  ë¯¸ì •ì‚° ë‚´ì—­ì„ ì¼ê´„ ì²˜ë¦¬
            // í˜„ì¬ëŠ” ë‹¨ì¼ ë‚´ì—­ ì²˜ë¦¬ ì˜ˆì‹œ
            
            const params = {
                lunchId: currentLunchId, // ì‹¤ì œë¡œëŠ” ì‚¬ìš©ìë³„ ì¼ê´„ ì²˜ë¦¬ í•„ìš”
                updateUserId: '[[${loginVO.userId}]]'
            };
            
            $.ajax({
                url: '/lunch/completeSettlement.do',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(params),
                success: function(response) {
                    if (response.success) {
                        alert(response.message);
                        closeModal('settlementModal');
                        loadLunchList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    } else {
                        alert(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('ì •ì‚°ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    alert('ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        $(document).on('click', '.modal', function(e) {
            if ($(e.target).hasClass('modal')) {
                $(this).removeClass('show');
            }
        });
    </script>
</body>
</html>
